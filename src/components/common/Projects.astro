---
import dataProvider from '~/config/dataProvider';
import Image from '~/components/common/Image.astro';
import { projectTypes } from '~/config/typesMapping';
import { arrayOf } from '~/utils/utils';

export interface Props {
  projectsUris: string | [string];
}

const { projectsUris } = Astro.props;

let { data: projects } = await dataProvider.getMany('Project', {
  ids: arrayOf(projectsUris),
});

const getCategoryFromType = (type: string | [string]) =>
  Object.keys(projectTypes).find((key) => arrayOf(type).includes(projectTypes[key]));

projects = projects.filter((project) => project?.type === 'pair:Project');
---

{
  (
    <div class="grid gap-8 grid-cols-3 -mb-6">
      {projects.map((project) => (
        <div class="">
          <article class="mb-6 transition">
            <div class="relative md:h-64 bg-gray-400 dark:bg-slate-700 rounded shadow-lg mb-6">
              {project.image && (
                <a href={`/projets/${getCategoryFromType(project['pair:hasType'])}/${encodeURIComponent(project.id)}`}>
                  <Image
                    src={project.image}
                    class="w-full md:h-full rounded shadow-lg bg-gray-400 dark:bg-slate-700"
                    widths={[400, 900]}
                    width={400}
                    sizes="(max-width: 900px) 400px, 900px"
                    alt={project['pair:label']}
                    aspectRatio="16:9"
                    layout="cover"
                    loading="lazy"
                    decoding="async"
                  />
                </a>
              )}
            </div>
            <h3 class="mb-2 text-xl font-bold leading-tight sm:text-2xl font-heading">
              <a
                href={`/projets/${getCategoryFromType(project['pair:hasType'])}/${encodeURIComponent(project.id)}`}
                class="hover:text-primary dark:hover:text-blue-700  transition ease-in duration-200"
              >
                {project['pair:label']}
              </a>
            </h3>
            <p class="text-muted dark:text-slate-400 text-lg">{project['pair:comment']}</p>
          </article>
        </div>
      ))}
    </div>
  )
}
